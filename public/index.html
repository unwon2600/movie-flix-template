<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Movie Flix</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body{font-family:Arial;padding:20px;background:#fafafa;}
    .card{background:#fff;border:1px solid #ddd;padding:12px;margin:12px 0;display:flex;gap:12px;border-radius:8px;}
    img{width:120px;height:80px;object-fit:cover;border-radius:4px;}
    .btn{padding:8px 12px;background:#0070f3;color:white;text-decoration:none;border-radius:6px;}
  </style>
</head>
<body>
<h1>Movie Flix</h1>
<div id="list">Loadingâ€¦</div>

<script>
async function load(){
  const res = await fetch('/api/movies');
  const data = await res.json();
  const list = document.getElementById('list');

  if(!data.length){
    list.innerHTML = "<p>No movies uploaded yet.</p>";
    return;
  }

  list.innerHTML = "";
  data.forEach(m=>{
    let tgLink = m.channel_username ? `https://t.me/${m.channel_username}/${m.telegram_message_id}` : '#';
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <img src="${m.poster_id ? '/api/file?id='+m.poster_id : '/placeholder.png'}"/>
      <div style="flex:1">
        <h3>${escape(m.title)}</h3>
        <p style="white-space:pre-wrap">${escape(m.description||'')}</p>
      </div>
      <a class="btn" href="${tgLink}" target="_blank">View</a>
    `;
    list.appendChild(card);
  });
}

function escape(s){
  return (s||'')
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;');
}

load();
</script>
</body>
</html>
